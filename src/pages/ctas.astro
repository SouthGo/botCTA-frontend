---
import DashboardLayout from '@layouts/DashboardLayout.astro';
import CtaCard from '@components/CtaCard.jsx';
import LoginButton from '@components/LoginButton.jsx';
import { api } from '@lib/api.js';
import { readSessionCookie } from '@lib/auth.js';

const sessionCookie = Astro.cookies.get('session')?.value ?? '';
const user = readSessionCookie(sessionCookie);
const ctas = await api.listCtas();
---

<DashboardLayout title="Panel principal">
  <div slot="header-actions">
    <LoginButton user={user} />
  </div>

  <section class="space-y-6">
    <header class="flex flex-col gap-2">
      <h2 class="text-2xl font-semibold text-white">CTAs activas</h2>
      <p class="text-sm text-slate-400">
        Gestiona las CTA del gremio, consulta postulantes y monitoriza el estado.
      </p>
    </header>

    <div class="grid gap-6 md:grid-cols-2">
      {ctas.length ? (
        ctas.map((cta) => <CtaCard cta={cta} href={`/ctas/${cta.id}`} />)
      ) : (
        <p class="text-slate-400">No hay CTAs disponibles. Â¡Crea una desde Discord!</p>
      )}
    </div>
  </section>
</DashboardLayout>

